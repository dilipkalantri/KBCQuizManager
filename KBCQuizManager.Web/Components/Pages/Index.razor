@page "/"
@inject IAuthService AuthService
@inject IQuestionService QuestionService
@inject ICategoryService CategoryService

<PageTitle>Dashboard - KBC Quiz Manager</PageTitle>

@if (_currentUser != null)
{
    <!-- Welcome -->
    <div style="margin-bottom: 30px;">
        <h1 style="color: white; font-size: 28px; margin: 0 0 8px 0;">Welcome back, @_currentUser.FirstName! üëã</h1>
        <p style="color: #9ca3af; margin: 0;">Here's your quiz management overview.</p>
    </div>
    
    <!-- Stats Cards -->
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
        <div style="background: #16213e; border: 1px solid #2a3f5f; border-radius: 12px; padding: 25px;">
            <div style="display: flex; justify-content: space-between; align-items: start;">
                <div>
                    <p style="color: #9ca3af; margin: 0 0 8px 0; font-size: 14px;">Categories</p>
                    <h2 style="color: white; font-size: 36px; margin: 0;">@_stats.TotalCategories</h2>
                </div>
                <div style="width: 50px; height: 50px; background: #3b82f6; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px;">üìÅ</div>
            </div>
        </div>
        
        <div style="background: #16213e; border: 1px solid #2a3f5f; border-radius: 12px; padding: 25px;">
            <div style="display: flex; justify-content: space-between; align-items: start;">
                <div>
                    <p style="color: #9ca3af; margin: 0 0 8px 0; font-size: 14px;">Total Questions</p>
                    <h2 style="color: white; font-size: 36px; margin: 0;">@_stats.TotalQuestions</h2>
                </div>
                <div style="width: 50px; height: 50px; background: #7c3aed; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px;">‚ùì</div>
            </div>
        </div>
        
        <div style="background: #16213e; border: 1px solid #2a3f5f; border-radius: 12px; padding: 25px;">
            <div style="display: flex; justify-content: space-between; align-items: start;">
                <div>
                    <p style="color: #9ca3af; margin: 0 0 8px 0; font-size: 14px;">Active Questions</p>
                    <h2 style="color: white; font-size: 36px; margin: 0;">@_stats.ActiveQuestions</h2>
                </div>
                <div style="width: 50px; height: 50px; background: #10b981; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px;">‚úÖ</div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div style="margin-bottom: 30px;">
        <h2 style="color: white; font-size: 20px; margin: 0 0 15px 0;">Quick Actions</h2>
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
            <a href="/admin/categories" style="text-decoration: none;">
                <div style="background: #16213e; border: 1px solid #2a3f5f; border-radius: 10px; padding: 20px; transition: all 0.2s;">
                    <div style="font-size: 28px; margin-bottom: 10px;">üìÅ</div>
                    <h3 style="color: white; font-size: 16px; margin: 0 0 5px 0;">Add Category</h3>
                    <p style="color: #6b7280; font-size: 13px; margin: 0;">Create new category</p>
                </div>
            </a>
            
            <a href="/admin/questions" style="text-decoration: none;">
                <div style="background: #16213e; border: 1px solid #2a3f5f; border-radius: 10px; padding: 20px; transition: all 0.2s;">
                    <div style="font-size: 28px; margin-bottom: 10px;">‚ûï</div>
                    <h3 style="color: white; font-size: 16px; margin: 0 0 5px 0;">Add Question</h3>
                    <p style="color: #6b7280; font-size: 13px; margin: 0;">Create new question</p>
                </div>
            </a>
            
            <a href="/admin/import" style="text-decoration: none;">
                <div style="background: #16213e; border: 1px solid #2a3f5f; border-radius: 10px; padding: 20px; transition: all 0.2s;">
                    <div style="font-size: 28px; margin-bottom: 10px;">üì§</div>
                    <h3 style="color: white; font-size: 16px; margin: 0 0 5px 0;">Import Questions</h3>
                    <p style="color: #6b7280; font-size: 13px; margin: 0;">Bulk import CSV</p>
                </div>
            </a>
            
            <a href="/admin/game-preview" style="text-decoration: none;">
                <div style="background: #16213e; border: 1px solid #2a3f5f; border-radius: 10px; padding: 20px; transition: all 0.2s;">
                    <div style="font-size: 28px; margin-bottom: 10px;">üéÆ</div>
                    <h3 style="color: white; font-size: 16px; margin: 0 0 5px 0;">Game Preview</h3>
                    <p style="color: #6b7280; font-size: 13px; margin: 0;">Test your quiz</p>
                </div>
            </a>
        </div>
    </div>
    
    <!-- Two Column Layout -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <!-- Difficulty Distribution -->
        <div style="background: #16213e; border: 1px solid #2a3f5f; border-radius: 12px; padding: 25px;">
            <h2 style="color: white; font-size: 18px; margin: 0 0 20px 0;">Questions by Difficulty</h2>
            
            <div style="margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span style="color: #9ca3af; font-size: 14px;">Easy</span>
                    <span style="color: white; font-weight: 600;">@_stats.EasyQuestions</span>
                </div>
                <div style="height: 8px; background: #2a3f5f; border-radius: 4px; overflow: hidden;">
                    <div style="height: 100%; width: @(GetPercent(_stats.EasyQuestions))%; background: #10b981; border-radius: 4px;"></div>
                </div>
            </div>
            
            <div style="margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span style="color: #9ca3af; font-size: 14px;">Medium</span>
                    <span style="color: white; font-weight: 600;">@_stats.MediumQuestions</span>
                </div>
                <div style="height: 8px; background: #2a3f5f; border-radius: 4px; overflow: hidden;">
                    <div style="height: 100%; width: @(GetPercent(_stats.MediumQuestions))%; background: #f59e0b; border-radius: 4px;"></div>
                </div>
            </div>
            
            <div style="margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span style="color: #9ca3af; font-size: 14px;">Hard</span>
                    <span style="color: white; font-weight: 600;">@_stats.HardQuestions</span>
                </div>
                <div style="height: 8px; background: #2a3f5f; border-radius: 4px; overflow: hidden;">
                    <div style="height: 100%; width: @(GetPercent(_stats.HardQuestions))%; background: #ef4444; border-radius: 4px;"></div>
                </div>
            </div>
            
            <div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span style="color: #9ca3af; font-size: 14px;">Expert</span>
                    <span style="color: white; font-weight: 600;">@_stats.ExpertQuestions</span>
                </div>
                <div style="height: 8px; background: #2a3f5f; border-radius: 4px; overflow: hidden;">
                    <div style="height: 100%; width: @(GetPercent(_stats.ExpertQuestions))%; background: #8b5cf6; border-radius: 4px;"></div>
                </div>
            </div>
        </div>
        
        <!-- Categories -->
        <div style="background: #16213e; border: 1px solid #2a3f5f; border-radius: 12px; padding: 25px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color: white; font-size: 18px; margin: 0;">Your Categories</h2>
                <a href="/admin/categories" style="color: #7c3aed; font-size: 14px; text-decoration: none;">View All</a>
            </div>
            
            @if (_categories.Any())
            {
                @foreach (var cat in _categories.Take(5))
                {
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #1a1a2e; border-radius: 8px; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 35px; height: 35px; background: @(cat.Color ?? "#7c3aed"); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white;">üìÅ</div>
                            <span style="color: white;">@cat.Name</span>
                        </div>
                        <span style="background: #2a3f5f; color: #7c3aed; padding: 4px 10px; border-radius: 12px; font-size: 13px; font-weight: 600;">@cat.QuestionCount</span>
                    </div>
                }
            }
            else
            {
                <div style="text-align: center; padding: 30px;">
                    <p style="color: #6b7280; margin: 0 0 15px 0;">No categories yet</p>
                    <a href="/admin/categories" style="color: #7c3aed; text-decoration: none;">Create your first category ‚Üí</a>
                </div>
            }
        </div>
    </div>
}

@code {
    private ApplicationUser? _currentUser;
    private QuestionStatistics _stats = new();
    private List<Category> _categories = new();

    protected override async Task OnInitializedAsync()
    {
        _currentUser = await AuthService.GetCurrentUserAsync();
        if (_currentUser != null)
        {
            _stats = await QuestionService.GetStatisticsAsync(_currentUser.Id);
            _categories = await CategoryService.GetCategoriesAsync(_currentUser.Id);
        }
    }

    private int GetPercent(int count)
    {
        return _stats.TotalQuestions > 0 ? (int)((double)count / _stats.TotalQuestions * 100) : 0;
    }
}
